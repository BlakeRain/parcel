<form id="upload-list-container">
  <div class="flex flex-col border border-slate-400 dark:border-gray-700 dark:bg-gray-800 rounded-md shadow-md">
    <div class="flex flex-row justify-between p-4">
      <h1 class="text-4xl font-bold">
        Your uploads
      </h1>
      <div class="flex flex-row items-center gap-2">
        <button
          id="delete_selected"
          type="button"
          class="button"
          hx-trigger="click"
          hx-delete="/uploads/list"
          hx-target="#upload-list-container"
          hx-select="#upload-list-container"
          hx-confirm="Are you sure you want to delete the selected files?"
          hx-swap="outerHTML"
          disabled>
          <span class="icon-trash-2"></span>
          Delete
        </button>
        <button
          id="upload-refresh"
          type="button"
          class="button"
          hx-trigger="click,refresh-event"
          hx-get="/uploads/list"
          hx-target="#upload-list-container"
          hx-select="#upload-list-container"
          hx-swap="outerHTML">
          <span class="icon-refresh-cw"></span>
          Refresh
        </button>
      </div>
    </div>
    <div class="table">
      <table>
        <thead>
          <tr>
            <th class="slim">
              <parcel-checkbox-group id="uploads_group" name="uploads">
              </parcel-checkbox-group>
            </th>
            <th class="text-nowrap text-left">File</th>
            <th class="text-nowrap text-right">Size</th>
            <th class="text-nowrap text-right">Downloads</th>
            <th class="text-nowrap text-right">Remaining</th>
            <th class="text-nowrap text-left">Expires</th>
            <th>Public</th>
            <th class="text-nowrap text-left">Uploaded</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% if uploads | length == 0 %}
          <tr>
            <td colspan="9" class="text-center italic">
              Nothing to show
            </td>
          </tr>
          {% endif %}
          {% for upload in uploads %}
            <tr>
              <td class="slim text-center">
                <parcel-grouped-checkbox
                  name="selected"
                  group="uploads"
                  value="{{ upload.id }}">
                </parcel-grouped-checkbox>
              </td>
              <td>
                <div class="flex flex-row gap-1">
                  <a class="text-nowrap" href="/uploads/{{ upload.slug }}">{{ upload.filename }}</a>
                  <parcel-clipboard url="true" value="/upload/{{ upload.slug }}"></parcel-clipboard>
                </div>
              </td>
              <td class="text-right text-nowrap">{{ upload.size | filesizeformat }}</td>
              <td class="text-right text-nowrap">{{ upload.downloads }}</td>
              <td class="text-right text-nowrap">
                {% if upload.limit is number %}
                {{ upload.limit - upload.downloads }}
                {% else %}
                <i>Unlimited</i>
                {% endif %}
              </td>
              <td class="text-nowrap">
                {% if upload.expiry_date %}
                  <parcel-date value="{{ upload.expiry_date | datetime }}">
                    {{ upload.expiry_date | datetime }}
                  </parcel-date>
                  ({{ upload.expiry_date | datetime_offset }})
                {% else %}
                <i>Never</i>
                {% endif %}
              </td>
              {% if upload.public %}
              <td class="text-center text-danger">Yes</td>
              {% else %}
              <td class="text-center text-success">No</td>
              {% endif %}
              <td class="text-left text-nowrap">
                <parcel-datetime value="{{ upload.uploaded_at | datetime }}">
                  {{ upload.uploaded_at | datetime }}
                </parcel-datetime>
              </td>
              <td class="text-right">
                <a href="/uploads/{{ upload.slug }}/download" title="Download {{ upload.filename }}">
                  <span class="icon-download"></span>
                </a>
                <a
                  href="#"
                  title="Edit upload settings"
                  hx-get="/uploads/{{ upload.id }}/edit"
                  hx-trigger="click"
                  hx-target="body"
                  hx-swap="beforeend">
                  <span class="icon-pencil"></span>
                </a>
                <a
                  href="#"
                  title="Delete upload"
                  hx-delete="/uploads/{{ upload.id }}"
                  hx-trigger="click"
                  hx-target="closest tr"
                  hx-swap="outerHTML swap:0.5s"
                  hx-confirm="Are you sure you want to delete this upload?">
                  <span class="icon-trash-2"></span>
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  // function handleMassCheckboxClick(element) {
  //   const checkboxes = document.querySelectorAll("input[name=selected]");
  //   checkboxes.forEach(checkbox => {
  //     checkbox.checked = element.checked;
  //   });
  //
  //   const massDelete = document.getElementById("delete_selected");
  //   massDelete.disabled = !element.checked;
  // }
  //
  // function updateMassCheckbox() {
  //   const checkboxes = document.querySelectorAll("input[name=selected]");
  //   const checked = Array.from(checkboxes).filter(checkbox => checkbox.checked);
  //
  //   const massCheckbox = document.getElementById("mass_checkbox");
  //   massCheckbox.checked = checked.length === checkboxes.length;
  //   massCheckbox.indeterminate = checked.length > 0 && checked.length < checkboxes.length;
  //
  //   const massDelete = document.getElementById("delete_selected");
  //   massDelete.disabled = checked.length === 0;
  // }
  //
  // var lastChecked = null, lastCheckedIndex = 0;
  // function handleCheckboxClick(element, event, index) {
  //   if (event.shiftKey) {
  //     if (lastChecked) {
  //       const start = Math.min(index, lastCheckedIndex);
  //       const end = Math.max(index, lastCheckedIndex);
  //       for (let i = start; i <= end; i++) {
  //         document.getElementById(`${i}_checkbox`).checked = lastChecked.checked;
  //       }
  //     }
  //   }
  //
  //   lastChecked = element;
  //   lastCheckedIndex = index;
  //   updateMassCheckbox();
  // }
  (function() {
    document.getElementById("uploads_group").addEventListener("changed", (event) => {
      document.getElementById("delete_selected").disabled = !event.detail.any;
    });
  })();
</script>
